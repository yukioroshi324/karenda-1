<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>学習タイマー</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .container {
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 350px;
      width: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .header {
      display: flex;
      justify-content: space-between;
      width: 100%;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .timer {
      position: relative;
      width: 200px;
      height: 200px;
      margin-bottom: 20px;
    }

    .timer svg {
      transform: rotate(-90deg);
    }

    .timer-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 32px;
      font-weight: bold;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 20px; /* ← 横向き用の元の余白 */
    }

    .controls button {
      flex: 1;
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.2s;
    }

    .controls button:hover {
      opacity: 0.85;
    }

    #start {
      background: #333;
      color: white;
    }
    #next {
      background: #007bff;
      color: white;
    }
    #end {
      background: #dc3545;
      color: white;
    }

    .shortcuts, .legend {
      margin-top: 15px;
      font-size: 13px;
      text-align: center;
    }

    .legend span {
      display: inline-block;
      margin: 4px 6px;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      color: white;
    }

    .focus { background: #007bff; }
    .short-break { background: #28a745; }
    .long-break { background: #6f42c1; }

    /* 📱 縦画面時だけ下に固定 */
    @media (orientation: portrait) {
      .controls {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        margin: 0;             /* 上の余白をリセット */
        background: #fff;
        padding: 10px;
        box-shadow: 0 -2px 6px rgba(0,0,0,0.1);
        border-top: 1px solid #ddd;
      }
      .container {
        margin-bottom: 80px;   /* 下ボタンと被らない余白 */
      }
    }

    /* 🌙 ダークモード */
    @media (prefers-color-scheme: dark) {
      body { background: #121212; }
      .container { background: #1e1e1e; color: #fff; }
      .controls { background: #1e1e1e; border-top: 1px solid #333; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div id="mode">集中 25:00</div>
      <div id="set">1セット目</div>
    </div>

    <div class="timer">
      <svg width="200" height="200">
        <circle cx="100" cy="100" r="90" stroke="#ddd" stroke-width="15" fill="none" />
        <circle id="progress" cx="100" cy="100" r="90"
          stroke="#007bff" stroke-width="15" fill="none"
          stroke-dasharray="565" stroke-dashoffset="0"
          stroke-linecap="round"/>
      </svg>
      <div class="timer-text" id="time">25:00</div>
    </div>

    <div class="controls">
      <button id="start">開始</button>
      <button id="next">次へ</button>
      <button id="end">終了</button>
    </div>

    <div class="shortcuts">スペース: 一時停止/再開・K: 次へ・E: 終了</div>
    <div class="legend">
      <span class="focus">集中 25分</span>
      <span class="short-break">休憩 5分</span>
      <span class="long-break">長休憩 15分</span>
    </div>
  </div>

  <audio id="bell" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

  <script>
    const timerDisplay = document.getElementById("time");
    const modeDisplay = document.getElementById("mode");
    const setDisplay = document.getElementById("set");
    const progressCircle = document.getElementById("progress");
    const startBtn = document.getElementById("start");
    const nextBtn = document.getElementById("next");
    const endBtn = document.getElementById("end");
    const bell = document.getElementById("bell");

    const MODES = [
      { name: "集中", duration: 25*60, color: "#007bff" },
      { name: "休憩", duration: 5*60, color: "#28a745" },
      { name: "長休憩", duration: 15*60, color: "#6f42c1" }
    ];

    let currentMode = 0;
    let setCount = 1;
    let timeLeft = MODES[0].duration;
    let timerId = null;

    function updateDisplay(){
      let m = Math.floor(timeLeft/60).toString().padStart(2,"0");
      let s = (timeLeft%60).toString().padStart(2,"0");
      timerDisplay.textContent = `${m}:${s}`;
      modeDisplay.textContent = `${MODES[currentMode].name} ${m}:${s}`;
      setDisplay.textContent = `${setCount}セット目`;

      let progress = 565 - (timeLeft / MODES[currentMode].duration) * 565;
      progressCircle.setAttribute("stroke-dashoffset", progress);
      progressCircle.setAttribute("stroke", MODES[currentMode].color);
    }

    function tick(){
      if(timeLeft > 0){
        timeLeft--;
        updateDisplay();
      }else{
        bell.play();
        nextMode();
      }
    }

    function startTimer(){
      if(timerId){
        clearInterval(timerId);
        timerId = null;
        startBtn.textContent = "再開";
      }else{
        timerId = setInterval(tick,1000);
        startBtn.textContent = "一時停止";
      }
    }

    function nextMode(){
      clearInterval(timerId);
      timerId = null;
      startBtn.textContent = "開始";

      if(currentMode === 0){
        if(setCount % 4 === 0){ currentMode = 2; }
        else{ currentMode = 1; }
      }else{
        currentMode = 0;
        if(setCount % 4 === 0) setCount++;
      }
      timeLeft = MODES[currentMode].duration;
      updateDisplay();
    }

    function endTimer(){
      clearInterval(timerId);
      timerId = null;
      currentMode = 0;
      setCount = 1;
      timeLeft = MODES[0].duration;
      updateDisplay();
      startBtn.textContent = "開始";
    }

    startBtn.onclick = startTimer;
    nextBtn.onclick = nextMode;
    endBtn.onclick = endTimer;

    document.addEventListener("keydown",e=>{
      if(e.code==="Space"){ e.preventDefault(); startTimer(); }
      if(e.key==="k"||e.key==="K") nextMode();
      if(e.key==="e"||e.key==="E") endTimer();
    });

    updateDisplay();
  </script>
</body>
</html>
